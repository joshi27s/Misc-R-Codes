---
title: "581 HW3 Programming Questions"
author: "Austin Craig"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(boot)
library(lmtest)
library(extraDistr)
library(sandwich)
library(wooldridge)
```

### Question 1

```{r}

data("ceosal1")
model1 = lm(salary ~ roe, data=ceosal1)
plot(ceosal1$roe, ceosal1$salary, main="Simple Regression of Salary on ROE",
     xlab="ROE", ylab="Salary")
abline(model1)

```

We appear to have heteroskedasticity since the variance of the residuals appears to decrease above an ROE of about 35.

### Question 2

```{r}

#Homoskedastic standard errors:
summary(model1)

```

```{r}

#Heteroskedastic standard errors:
coeftest(model1, vcov=vcovHC(model1, type="HC0"))

```
Notice that the HC0 standard errors are significantly smaller than the homoskedastic standard errors.

### Question 3

```{r}
set.seed(123)
n = nrow(ceosal1)
  
#Estimate bootstrap standard errors

B=1000
#init bootstrap beta matrix
betahat_b = matrix(0,B,2)

for (i in 1:B) {
  idx = sample(n, size=n, replace=TRUE)
  tmpData = ceosal1[idx,]
  tmpModel = lm(salary ~ roe, data=tmpData)
  betahat_b[i,] = coef(tmpModel)
}

#calculate bootstrap standard errors
sehat_betahat_b = apply(betahat_b,2,sd)
sehat_betahat_b

```

Notice that the nonparametric bootstrap standard errors approximate the HC0 standard errors.

### Question 4

```{r}

#get residuals and beta hats from OLS
res = residuals(model1)
betahat = coef(model1)

B=1000
#init fixed-x bootstrap beta matrix
betahat_fx = matrix(0,B,2)

for (i in 1:B) {
  #draw sample of residuals with replacement
  idx = sample(n, size=n, replace=TRUE)
  e_star = res[idx]
  
  #calculate y star (y=salary)
  y_star_fx = betahat[1] + betahat[2]*ceosal1$roe + e_star
  
  #calculate bootstrap betahat
  tmpModel = lm(y_star_fx ~ ceosal1$roe)
  betahat_fx[i,] = coef(tmpModel)
}

#calculate bootstrap standard errors
sehat_betahat_fx = apply(betahat_fx,2,sd)
sehat_betahat_fx
```

See that the "fixed-X" bootstrap standard errors are comparable to the homoskedastic standard errors.

### Question 5

```{r}

#get residuals and beta hats from OLS
res = residuals(model1)
betahat = coef(model1)

B=1000
#init wild bootstrap beta matrix
betahat_w = matrix(0,B,2)

for (i in 1:B) {
  #draw sample of residuals with replacement
  idx = sample(n, size=n, replace=TRUE)
  e_star = res[idx]
  
  #generate Rademacher random variables
  xi = rsign(n)
  
  #calculate y star (y=salary)
  y_star_w = betahat[1] + betahat[2]*ceosal1$roe + e_star*xi
  
  #calculate bootstrap betahat
  tmpModel = lm(y_star_w ~ ceosal1$roe)
  betahat_w[i,] = coef(tmpModel)
}

#calculate bootstrap standard errors
sehat_betahat_w = apply(betahat_w,2,sd)
sehat_betahat_w
```
Again, see that the wild bootstrap standard errors approximate the homoskedastic standard errors.
